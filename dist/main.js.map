{"version":3,"sources":["main.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","appendHtml","el","str","div","document","createElement","innerHTML","children","appendChild","clearChildren","firstChild","removeChild","Object","defineProperty","value","2","_interopRequireDefault","obj","__esModule","default","_search","_search2","search","addEventListener","initialize","./search","3","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","_helpers","Preview","this","itemsData","_this","resultsContainer","querySelector","lightbox","previewBox","matches","currentItem","parseInt","dataset","itemIndex","setPreviewItem","showLightbox","nextItem","previousItem","closeLightbox","event","window","keyCode","charCode","preventDefault","classList","add","remove","previewNextButton","previewPrevButton","image","./helpers","4","_preview","_preview2","Search","lastSearchedTerm","preview","searchForm","searchTextBox","searchTerm","fetch","encodeURIComponent","then","response","json","meta","status","results","data","updateResults","map","item","images","original","url","alert","bind","ex","console","log","resultsElementString","fixed_width","./preview","whatwg-fetch","5","self","normalizeName","name","String","test","toLowerCase","normalizeValue","iteratorFor","items","iterator","next","shift","done","undefined","support","iterable","Symbol","Headers","headers","forEach","append","getOwnPropertyNames","consumed","body","bodyUsed","Promise","reject","fileReaderReady","reader","resolve","onload","result","onerror","error","readBlobAsArrayBuffer","blob","FileReader","promise","readAsArrayBuffer","readBlobAsText","readAsText","readArrayBufferAsText","buf","view","Uint8Array","chars","Array","fromCharCode","join","bufferClone","slice","byteLength","set","buffer","Body","_initBody","_bodyInit","_bodyText","Blob","isPrototypeOf","_bodyBlob","formData","FormData","_bodyFormData","searchParams","URLSearchParams","toString","arrayBuffer","isDataView","_bodyArrayBuffer","ArrayBuffer","isArrayBufferView","get","type","rejected","text","decode","JSON","parse","normalizeMethod","method","upcased","toUpperCase","methods","indexOf","Request","input","options","credentials","mode","referrer","form","trim","split","bytes","replace","decodeURIComponent","parseHeaders","rawHeaders","line","parts","Response","bodyInit","ok","statusText","viewClasses","DataView","isView","oldValue","has","hasOwnProperty","callback","thisArg","keys","push","values","entries","clone","redirectStatuses","redirect","RangeError","location","init","request","xhr","XMLHttpRequest","getAllResponseHeaders","responseURL","responseText","ontimeout","open","withCredentials","responseType","setRequestHeader","send","polyfill"],"mappings":"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","file":"main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.appendHtml = appendHtml;\nexports.clearChildren = clearChildren;\nfunction appendHtml(el, str) {\n    var div = document.createElement('div');\n    div.innerHTML = str;\n    while (div.children.length > 0) {\n        el.appendChild(div.children[0]);\n    }\n}\n\nfunction clearChildren(el) {\n    while (el.firstChild) {\n        el.removeChild(el.firstChild);\n    }\n}\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\n\nvar _search = require(\"./search\");\n\nvar _search2 = _interopRequireDefault(_search);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar search = new _search2.default();\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n    search.initialize();\n});\n\n},{\"./search\":4}],3:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _helpers = require('./helpers');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Preview = function () {\n    function Preview() {\n        _classCallCheck(this, Preview);\n    }\n\n    _createClass(Preview, [{\n        key: 'initialize',\n        value: function initialize(itemsData) {\n            var _this = this;\n\n            this.resultsContainer = document.querySelector('.js-resultsContainer');\n            this.lightbox = document.querySelector('.js-lightbox');\n            this.previewBox = document.querySelector('.js-preview');\n\n            this.itemsData = itemsData;\n\n            this.resultsContainer.addEventListener('click', function (e) {\n                if (e.target.matches('.js-resultsItem')) {\n                    _this.currentItem = parseInt(e.target.dataset.itemIndex);\n                    _this.setPreviewItem();\n                    _this.showLightbox();\n                }\n            });\n\n            this.lightbox.addEventListener('click', function (e) {\n                if (e.target.matches('.js-previewNext')) {\n                    _this.nextItem();\n                } else if (e.target.matches('.js-previewPrev')) {\n                    _this.previousItem();\n                } else {\n                    if (e.target.matches('.js-previewClose, .js-preview')) {\n                        _this.closeLightbox();\n                    }\n                }\n            });\n\n            document.addEventListener('keydown', function (event) {\n                if (!event) event = window.event;\n                var code = event.keyCode;\n                if (event.charCode && code == 0) code = event.charCode;\n                switch (code) {\n                    case 37:\n                        // Key left.\n                        _this.previousItem();\n                        break;\n                    case 39:\n                        // Key right\n                        _this.nextItem();\n                        break;\n                    case 27:\n                        // ESC\n                        _this.closeLightbox();\n                        break;\n                }\n                event.preventDefault();\n            });\n        }\n    }, {\n        key: 'previousItem',\n        value: function previousItem() {\n            if (this.currentItem > 0) {\n                this.currentItem -= 1;\n                this.setPreviewItem();\n            }\n        }\n    }, {\n        key: 'nextItem',\n        value: function nextItem() {\n            if (this.currentItem < this.itemsData.length - 1) {\n                this.currentItem += 1;\n                this.setPreviewItem();\n            }\n        }\n    }, {\n        key: 'closeLightbox',\n        value: function closeLightbox() {\n            (0, _helpers.clearChildren)(this.previewBox);\n            this.lightbox.classList.add('u-isHidden');\n        }\n    }, {\n        key: 'showLightbox',\n        value: function showLightbox() {\n            this.lightbox.classList.remove('u-isHidden');\n        }\n    }, {\n        key: 'setPreviewItem',\n        value: function setPreviewItem() {\n            var previewNextButton = document.querySelector('.js-previewNext');\n            var previewPrevButton = document.querySelector('.js-previewPrev');\n\n            if (this.currentItem === 0) {\n                previewPrevButton.classList.add('u-isHidden');\n            } else {\n                previewPrevButton.classList.remove('u-isHidden');\n            }\n\n            if (this.currentItem === this.itemsData.length - 1) {\n                previewNextButton.classList.add('u-isHidden');\n            } else {\n                previewNextButton.classList.remove('u-isHidden');\n            }\n\n            this.previewBox.innerHTML = '<img src=\"' + this.itemsData[this.currentItem].image + '\"/>';\n        }\n    }]);\n\n    return Preview;\n}();\n\nexports.default = Preview;\n\n},{\"./helpers\":1}],4:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nrequire('whatwg-fetch');\n\nvar _helpers = require('./helpers');\n\nvar _preview = require('./preview');\n\nvar _preview2 = _interopRequireDefault(_preview);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Search = function () {\n    function Search() {\n        _classCallCheck(this, Search);\n\n        this.lastSearchedTerm = \"\";\n        this.preview = new _preview2.default();\n    }\n\n    _createClass(Search, [{\n        key: 'initialize',\n        value: function initialize() {\n            var _this = this;\n\n            var searchForm = document.querySelector('.js-searchForm');\n            var searchTextBox = document.querySelector('.js-searchTextBox');\n\n            // Search form submit event\n            searchForm.addEventListener('submit', function (e) {\n                e.preventDefault();\n                _this.search(searchTextBox.value);\n                return false;\n            });\n        }\n    }, {\n        key: 'search',\n        value: function search(searchTerm) {\n            if (searchTerm !== \"\" && searchTerm !== this.lastSearchedTerm) {\n                this.lastSearchedTerm = searchTerm;\n\n                fetch('http://api.giphy.com/v1/gifs/search?q=' + encodeURIComponent(searchTerm) + '&api_key=dc6zaTOxFJmzC&limit=50&offset=0').then(function (response) {\n                    return response.json();\n                }).then(function (json) {\n                    if (json.meta.status === 200) {\n                        this.results = json.data;\n                        this.updateResults();\n                        //initialize Preview Lightbox\n                        this.preview.initialize(json.data.map(function (item) {\n                            return { image: item.images.original.url };\n                        }));\n                    } else {\n                        alert(\"Problem in fetching data\");\n                    }\n                }.bind(this)).catch(function (ex) {\n                    console.log('parsing failed', ex);\n                });\n            }\n        }\n    }, {\n        key: 'updateResults',\n        value: function updateResults() {\n            var resultsContainer = document.querySelector('.js-resultsContainer');\n            (0, _helpers.clearChildren)(resultsContainer);\n            if (this.results && this.results.length) {\n                var resultsElementString = '<div class=\"SearchPage-results\">';\n                for (var i = 0; i < this.results.length; i++) {\n                    resultsElementString += '<div class=\"SearchItem SearchItem-sizeMedium js-resultsItem\"' + ('style=\"background-image: URL(' + this.results[i].images.fixed_width.url + ')\"') + (' data-item-index=\"' + i + '\"></div>');\n                }\n                resultsElementString += '</div>';\n                (0, _helpers.appendHtml)(resultsContainer, resultsElementString);\n            } else {\n                (0, _helpers.appendHtml)(resultsContainer, '<div class=\"SearchPage-noResults\">' + 'Your search did not match any giphy!<br/>Search for another term!<br/>' + '<div><iframe src=\"//giphy.com/embed/ZgCeagL3AmIGQ\" width=\"480\" height=\"136\" frameBorder=\"0\" class=\"giphy-embed\"' + ' allowFullScreen></iframe><p><a href=\"http://giphy.com/gifs/nothing-ZgCeagL3AmIGQ\">via GIPHY</a></p></div>' + '</div>');\n            }\n        }\n    }]);\n\n    return Search;\n}();\n\nexports.default = Search;\n\n},{\"./helpers\":1,\"./preview\":3,\"whatwg-fetch\":5}],5:[function(require,module,exports){\n(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ]\n\n    var isDataView = function(obj) {\n      return obj && DataView.prototype.isPrototypeOf(obj)\n    }\n\n    var isArrayBufferView = ArrayBuffer.isView || function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var oldValue = this.map[name]\n    this.map[name] = oldValue ? oldValue+','+value : value\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name)\n    return this.has(name) ? this.map[name] : null\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value)\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this)\n      }\n    }\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsArrayBuffer(blob)\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsText(blob)\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf)\n    var chars = new Array(view.length)\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i])\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength)\n      view.set(new Uint8Array(buf))\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (!body) {\n        this._bodyText = ''\n      } else if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer)\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer])\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body)\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      }\n    }\n\n    this.text = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n\n    if (typeof input === 'string') {\n      this.url = input\n    } else {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, { body: this._bodyInit })\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers()\n    rawHeaders.split('\\r\\n').forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n    return headers\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = 'status' in options ? options.status : 200\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = 'statusText' in options ? options.statusText : 'OK'\n    this.headers = new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init)\n      var xhr = new XMLHttpRequest()\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        }\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n},{}]},{},[2])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9oZWxwZXJzLmpzIiwianMvbWFpbi5qcyIsImpzL3ByZXZpZXcuanMiLCJqcy9zZWFyY2guanMiLCJub2RlX21vZHVsZXMvd2hhdHdnLWZldGNoL2ZldGNoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7UUNBZ0IsVSxHQUFBLFU7UUFRQSxhLEdBQUEsYTtBQVJULFNBQVMsVUFBVCxDQUFvQixFQUFwQixFQUF3QixHQUF4QixFQUE2QjtBQUNoQyxRQUFJLE1BQU0sU0FBUyxhQUFULENBQXVCLEtBQXZCLENBQVY7QUFDQSxRQUFJLFNBQUosR0FBZ0IsR0FBaEI7QUFDQSxXQUFPLElBQUksUUFBSixDQUFhLE1BQWIsR0FBc0IsQ0FBN0IsRUFBZ0M7QUFDNUIsV0FBRyxXQUFILENBQWUsSUFBSSxRQUFKLENBQWEsQ0FBYixDQUFmO0FBQ0g7QUFDSjs7QUFFTSxTQUFTLGFBQVQsQ0FBdUIsRUFBdkIsRUFBMkI7QUFDOUIsV0FBTyxHQUFHLFVBQVY7QUFBc0IsV0FBRyxXQUFILENBQWUsR0FBRyxVQUFsQjtBQUF0QjtBQUNIOzs7OztBQ1ZEOzs7Ozs7QUFFQSxJQUFNLFNBQVMsc0JBQWY7QUFDQSxTQUFTLGdCQUFULENBQTBCLGtCQUExQixFQUE4QyxZQUFXO0FBQ3JELFdBQU8sVUFBUDtBQUNILENBRkQ7Ozs7Ozs7Ozs7O0FDSEE7Ozs7SUFFcUIsTzs7Ozs7OzttQ0FDTixTLEVBQVc7QUFBQTs7QUFDbEIsaUJBQUssZ0JBQUwsR0FBd0IsU0FBUyxhQUFULENBQXVCLHNCQUF2QixDQUF4QjtBQUNBLGlCQUFLLFFBQUwsR0FBZ0IsU0FBUyxhQUFULENBQXVCLGNBQXZCLENBQWhCO0FBQ0EsaUJBQUssVUFBTCxHQUFrQixTQUFTLGFBQVQsQ0FBdUIsYUFBdkIsQ0FBbEI7O0FBRUEsaUJBQUssU0FBTCxHQUFpQixTQUFqQjs7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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJleHBvcnQgZnVuY3Rpb24gYXBwZW5kSHRtbChlbCwgc3RyKSB7XG4gICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdi5pbm5lckhUTUwgPSBzdHI7XG4gICAgd2hpbGUgKGRpdi5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgIGVsLmFwcGVuZENoaWxkKGRpdi5jaGlsZHJlblswXSk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJDaGlsZHJlbihlbCkge1xuICAgIHdoaWxlIChlbC5maXJzdENoaWxkKSBlbC5yZW1vdmVDaGlsZChlbC5maXJzdENoaWxkKTtcbn0iLCJpbXBvcnQgU2VhcmNoIGZyb20gJy4vc2VhcmNoJztcblxuY29uc3Qgc2VhcmNoID0gbmV3IFNlYXJjaCgpO1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZnVuY3Rpb24oKSB7XG4gICAgc2VhcmNoLmluaXRpYWxpemUoKTtcbn0pOyIsImltcG9ydCB7Y2xlYXJDaGlsZHJlbn0gZnJvbSAnLi9oZWxwZXJzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJldmlldyB7XG4gICAgaW5pdGlhbGl6ZShpdGVtc0RhdGEpIHtcbiAgICAgICAgdGhpcy5yZXN1bHRzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLXJlc3VsdHNDb250YWluZXInKTtcbiAgICAgICAgdGhpcy5saWdodGJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1saWdodGJveCcpO1xuICAgICAgICB0aGlzLnByZXZpZXdCb3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtcHJldmlldycpO1xuXG4gICAgICAgIHRoaXMuaXRlbXNEYXRhID0gaXRlbXNEYXRhO1xuXG4gICAgICAgIHRoaXMucmVzdWx0c0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZS50YXJnZXQubWF0Y2hlcygnLmpzLXJlc3VsdHNJdGVtJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRJdGVtID0gcGFyc2VJbnQoZS50YXJnZXQuZGF0YXNldC5pdGVtSW5kZXgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0UHJldmlld0l0ZW0oKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMaWdodGJveCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmxpZ2h0Ym94LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlLnRhcmdldC5tYXRjaGVzKCcuanMtcHJldmlld05leHQnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubmV4dEl0ZW0oKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQubWF0Y2hlcygnLmpzLXByZXZpZXdQcmV2JykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByZXZpb3VzSXRlbSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQubWF0Y2hlcygnLmpzLXByZXZpZXdDbG9zZSwgLmpzLXByZXZpZXcnKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTGlnaHRib3goKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmICghZXZlbnQpXG4gICAgICAgICAgICAgICAgZXZlbnQgPSB3aW5kb3cuZXZlbnQ7XG4gICAgICAgICAgICB2YXIgY29kZSA9IGV2ZW50LmtleUNvZGU7XG4gICAgICAgICAgICBpZiAoZXZlbnQuY2hhckNvZGUgJiYgY29kZSA9PSAwKVxuICAgICAgICAgICAgICAgIGNvZGUgPSBldmVudC5jaGFyQ29kZTtcbiAgICAgICAgICAgIHN3aXRjaCAoY29kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMzc6XG4gICAgICAgICAgICAgICAgICAgIC8vIEtleSBsZWZ0LlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpb3VzSXRlbSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDM5OlxuICAgICAgICAgICAgICAgICAgICAvLyBLZXkgcmlnaHRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0SXRlbSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDI3OlxuICAgICAgICAgICAgICAgICAgICAvLyBFU0NcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxpZ2h0Ym94KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJldmlvdXNJdGVtKCkge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50SXRlbSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEl0ZW0gLT0gMTtcbiAgICAgICAgICAgIHRoaXMuc2V0UHJldmlld0l0ZW0oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5leHRJdGVtKCkge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50SXRlbSA8IHRoaXMuaXRlbXNEYXRhLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEl0ZW0gKz0gMTtcbiAgICAgICAgICAgIHRoaXMuc2V0UHJldmlld0l0ZW0oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsb3NlTGlnaHRib3goKSB7XG4gICAgICAgIGNsZWFyQ2hpbGRyZW4odGhpcy5wcmV2aWV3Qm94KTtcbiAgICAgICAgdGhpcy5saWdodGJveC5jbGFzc0xpc3QuYWRkKCd1LWlzSGlkZGVuJyk7XG4gICAgfVxuXG4gICAgc2hvd0xpZ2h0Ym94KCkge1xuICAgICAgICB0aGlzLmxpZ2h0Ym94LmNsYXNzTGlzdC5yZW1vdmUoJ3UtaXNIaWRkZW4nKTtcbiAgICB9XG5cbiAgICBzZXRQcmV2aWV3SXRlbSgpIHtcbiAgICAgICAgY29uc3QgcHJldmlld05leHRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtcHJldmlld05leHQnKTtcbiAgICAgICAgY29uc3QgcHJldmlld1ByZXZCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtcHJldmlld1ByZXYnKTtcblxuICAgICAgICBpZiAodGhpcy5jdXJyZW50SXRlbSA9PT0gMCkge1xuICAgICAgICAgICAgcHJldmlld1ByZXZCdXR0b24uY2xhc3NMaXN0LmFkZCgndS1pc0hpZGRlbicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcHJldmlld1ByZXZCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgndS1pc0hpZGRlbicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEl0ZW0gPT09IHRoaXMuaXRlbXNEYXRhLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgIHByZXZpZXdOZXh0QnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3UtaXNIaWRkZW4nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHByZXZpZXdOZXh0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ3UtaXNIaWRkZW4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucHJldmlld0JveC5pbm5lckhUTUwgPSBgPGltZyBzcmM9XCIke3RoaXMuaXRlbXNEYXRhW3RoaXMuY3VycmVudEl0ZW1dLmltYWdlfVwiLz5gO1xuICAgIH1cbn0iLCJpbXBvcnQgJ3doYXR3Zy1mZXRjaCc7XG5pbXBvcnQge2FwcGVuZEh0bWwsIGNsZWFyQ2hpbGRyZW59IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgUHJldmlldyBmcm9tICcuL3ByZXZpZXcnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWFyY2gge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmxhc3RTZWFyY2hlZFRlcm0gPSBcIlwiO1xuICAgICAgICB0aGlzLnByZXZpZXcgPSBuZXcgUHJldmlldygpO1xuICAgIH1cblxuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIGNvbnN0IHNlYXJjaEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtc2VhcmNoRm9ybScpO1xuICAgICAgICBjb25zdCBzZWFyY2hUZXh0Qm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLXNlYXJjaFRleHRCb3gnKTtcblxuICAgICAgICAvLyBTZWFyY2ggZm9ybSBzdWJtaXQgZXZlbnRcbiAgICAgICAgc2VhcmNoRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5zZWFyY2goc2VhcmNoVGV4dEJveC52YWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNlYXJjaChzZWFyY2hUZXJtKSB7XG4gICAgICAgIGlmIChzZWFyY2hUZXJtICE9PSBcIlwiICYmIHNlYXJjaFRlcm0gIT09IHRoaXMubGFzdFNlYXJjaGVkVGVybSkge1xuICAgICAgICAgICAgdGhpcy5sYXN0U2VhcmNoZWRUZXJtID0gc2VhcmNoVGVybTtcblxuICAgICAgICAgICAgZmV0Y2goYGh0dHA6Ly9hcGkuZ2lwaHkuY29tL3YxL2dpZnMvc2VhcmNoP3E9JHtlbmNvZGVVUklDb21wb25lbnQoc2VhcmNoVGVybSl9JmFwaV9rZXk9ZGM2emFUT3hGSm16QyZsaW1pdD01MCZvZmZzZXQ9MGApXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKClcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgICAgICAgICAgaWYgKGpzb24ubWV0YS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdHMgPSBqc29uLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUmVzdWx0cygpO1xuICAgICAgICAgICAgICAgICAgICAvL2luaXRpYWxpemUgUHJldmlldyBMaWdodGJveFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXcuaW5pdGlhbGl6ZShqc29uLmRhdGEubWFwKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtpbWFnZTogaXRlbS5pbWFnZXMub3JpZ2luYWwudXJsfTtcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiUHJvYmxlbSBpbiBmZXRjaGluZyBkYXRhXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSkuY2F0Y2goZnVuY3Rpb24gKGV4KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3BhcnNpbmcgZmFpbGVkJywgZXgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgdXBkYXRlUmVzdWx0cygpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0c0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1yZXN1bHRzQ29udGFpbmVyJyk7XG4gICAgICAgIGNsZWFyQ2hpbGRyZW4ocmVzdWx0c0NvbnRhaW5lcik7XG4gICAgICAgIGlmICh0aGlzLnJlc3VsdHMgJiYgdGhpcy5yZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IHJlc3VsdHNFbGVtZW50U3RyaW5nID0gJzxkaXYgY2xhc3M9XCJTZWFyY2hQYWdlLXJlc3VsdHNcIj4nO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJlc3VsdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzRWxlbWVudFN0cmluZyArPSBgPGRpdiBjbGFzcz1cIlNlYXJjaEl0ZW0gU2VhcmNoSXRlbS1zaXplTWVkaXVtIGpzLXJlc3VsdHNJdGVtXCJgICtcbiAgICAgICAgICAgICAgICAgICAgYHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogVVJMKCR7dGhpcy5yZXN1bHRzW2ldLmltYWdlcy5maXhlZF93aWR0aC51cmx9KVwiYCArXG4gICAgICAgICAgICAgICAgICAgIGAgZGF0YS1pdGVtLWluZGV4PVwiJHtpfVwiPjwvZGl2PmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHRzRWxlbWVudFN0cmluZyArPSAnPC9kaXY+JztcbiAgICAgICAgICAgIGFwcGVuZEh0bWwocmVzdWx0c0NvbnRhaW5lciwgcmVzdWx0c0VsZW1lbnRTdHJpbmcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXBwZW5kSHRtbChyZXN1bHRzQ29udGFpbmVyLFxuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiU2VhcmNoUGFnZS1ub1Jlc3VsdHNcIj4nICtcbiAgICAgICAgICAgICAgICAnWW91ciBzZWFyY2ggZGlkIG5vdCBtYXRjaCBhbnkgZ2lwaHkhPGJyLz5TZWFyY2ggZm9yIGFub3RoZXIgdGVybSE8YnIvPicgK1xuICAgICAgICAgICAgICAgICc8ZGl2PjxpZnJhbWUgc3JjPVwiLy9naXBoeS5jb20vZW1iZWQvWmdDZWFnTDNBbUlHUVwiIHdpZHRoPVwiNDgwXCIgaGVpZ2h0PVwiMTM2XCIgZnJhbWVCb3JkZXI9XCIwXCIgY2xhc3M9XCJnaXBoeS1lbWJlZFwiJyArXG4gICAgICAgICAgICAgICAgJyBhbGxvd0Z1bGxTY3JlZW4+PC9pZnJhbWU+PHA+PGEgaHJlZj1cImh0dHA6Ly9naXBoeS5jb20vZ2lmcy9ub3RoaW5nLVpnQ2VhZ0wzQW1JR1FcIj52aWEgR0lQSFk8L2E+PC9wPjwvZGl2PicgK1xuICAgICAgICAgICAgICAgICc8L2Rpdj4nKVxuICAgICAgICB9XG4gICAgfVxufSIsIihmdW5jdGlvbihzZWxmKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBpZiAoc2VsZi5mZXRjaCkge1xuICAgIHJldHVyblxuICB9XG5cbiAgdmFyIHN1cHBvcnQgPSB7XG4gICAgc2VhcmNoUGFyYW1zOiAnVVJMU2VhcmNoUGFyYW1zJyBpbiBzZWxmLFxuICAgIGl0ZXJhYmxlOiAnU3ltYm9sJyBpbiBzZWxmICYmICdpdGVyYXRvcicgaW4gU3ltYm9sLFxuICAgIGJsb2I6ICdGaWxlUmVhZGVyJyBpbiBzZWxmICYmICdCbG9iJyBpbiBzZWxmICYmIChmdW5jdGlvbigpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIG5ldyBCbG9iKClcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cbiAgICB9KSgpLFxuICAgIGZvcm1EYXRhOiAnRm9ybURhdGEnIGluIHNlbGYsXG4gICAgYXJyYXlCdWZmZXI6ICdBcnJheUJ1ZmZlcicgaW4gc2VsZlxuICB9XG5cbiAgaWYgKHN1cHBvcnQuYXJyYXlCdWZmZXIpIHtcbiAgICB2YXIgdmlld0NsYXNzZXMgPSBbXG4gICAgICAnW29iamVjdCBJbnQ4QXJyYXldJyxcbiAgICAgICdbb2JqZWN0IFVpbnQ4QXJyYXldJyxcbiAgICAgICdbb2JqZWN0IFVpbnQ4Q2xhbXBlZEFycmF5XScsXG4gICAgICAnW29iamVjdCBJbnQxNkFycmF5XScsXG4gICAgICAnW29iamVjdCBVaW50MTZBcnJheV0nLFxuICAgICAgJ1tvYmplY3QgSW50MzJBcnJheV0nLFxuICAgICAgJ1tvYmplY3QgVWludDMyQXJyYXldJyxcbiAgICAgICdbb2JqZWN0IEZsb2F0MzJBcnJheV0nLFxuICAgICAgJ1tvYmplY3QgRmxvYXQ2NEFycmF5XSdcbiAgICBdXG5cbiAgICB2YXIgaXNEYXRhVmlldyA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIG9iaiAmJiBEYXRhVmlldy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihvYmopXG4gICAgfVxuXG4gICAgdmFyIGlzQXJyYXlCdWZmZXJWaWV3ID0gQXJyYXlCdWZmZXIuaXNWaWV3IHx8IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIG9iaiAmJiB2aWV3Q2xhc3Nlcy5pbmRleE9mKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopKSA+IC0xXG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gbm9ybWFsaXplTmFtZShuYW1lKSB7XG4gICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgbmFtZSA9IFN0cmluZyhuYW1lKVxuICAgIH1cbiAgICBpZiAoL1teYS16MC05XFwtIyQlJicqKy5cXF5fYHx+XS9pLnRlc3QobmFtZSkpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgY2hhcmFjdGVyIGluIGhlYWRlciBmaWVsZCBuYW1lJylcbiAgICB9XG4gICAgcmV0dXJuIG5hbWUudG9Mb3dlckNhc2UoKVxuICB9XG5cbiAgZnVuY3Rpb24gbm9ybWFsaXplVmFsdWUodmFsdWUpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuICAgICAgdmFsdWUgPSBTdHJpbmcodmFsdWUpXG4gICAgfVxuICAgIHJldHVybiB2YWx1ZVxuICB9XG5cbiAgLy8gQnVpbGQgYSBkZXN0cnVjdGl2ZSBpdGVyYXRvciBmb3IgdGhlIHZhbHVlIGxpc3RcbiAgZnVuY3Rpb24gaXRlcmF0b3JGb3IoaXRlbXMpIHtcbiAgICB2YXIgaXRlcmF0b3IgPSB7XG4gICAgICBuZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gaXRlbXMuc2hpZnQoKVxuICAgICAgICByZXR1cm4ge2RvbmU6IHZhbHVlID09PSB1bmRlZmluZWQsIHZhbHVlOiB2YWx1ZX1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3VwcG9ydC5pdGVyYWJsZSkge1xuICAgICAgaXRlcmF0b3JbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gaXRlcmF0b3JcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gaXRlcmF0b3JcbiAgfVxuXG4gIGZ1bmN0aW9uIEhlYWRlcnMoaGVhZGVycykge1xuICAgIHRoaXMubWFwID0ge31cblxuICAgIGlmIChoZWFkZXJzIGluc3RhbmNlb2YgSGVhZGVycykge1xuICAgICAgaGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG4gICAgICAgIHRoaXMuYXBwZW5kKG5hbWUsIHZhbHVlKVxuICAgICAgfSwgdGhpcylcblxuICAgIH0gZWxzZSBpZiAoaGVhZGVycykge1xuICAgICAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoaGVhZGVycykuZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgIHRoaXMuYXBwZW5kKG5hbWUsIGhlYWRlcnNbbmFtZV0pXG4gICAgICB9LCB0aGlzKVxuICAgIH1cbiAgfVxuXG4gIEhlYWRlcnMucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgbmFtZSA9IG5vcm1hbGl6ZU5hbWUobmFtZSlcbiAgICB2YWx1ZSA9IG5vcm1hbGl6ZVZhbHVlKHZhbHVlKVxuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMubWFwW25hbWVdXG4gICAgdGhpcy5tYXBbbmFtZV0gPSBvbGRWYWx1ZSA/IG9sZFZhbHVlKycsJyt2YWx1ZSA6IHZhbHVlXG4gIH1cblxuICBIZWFkZXJzLnByb3RvdHlwZVsnZGVsZXRlJ10gPSBmdW5jdGlvbihuYW1lKSB7XG4gICAgZGVsZXRlIHRoaXMubWFwW25vcm1hbGl6ZU5hbWUobmFtZSldXG4gIH1cblxuICBIZWFkZXJzLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihuYW1lKSB7XG4gICAgbmFtZSA9IG5vcm1hbGl6ZU5hbWUobmFtZSlcbiAgICByZXR1cm4gdGhpcy5oYXMobmFtZSkgPyB0aGlzLm1hcFtuYW1lXSA6IG51bGxcbiAgfVxuXG4gIEhlYWRlcnMucHJvdG90eXBlLmhhcyA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5tYXAuaGFzT3duUHJvcGVydHkobm9ybWFsaXplTmFtZShuYW1lKSlcbiAgfVxuXG4gIEhlYWRlcnMucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgdGhpcy5tYXBbbm9ybWFsaXplTmFtZShuYW1lKV0gPSBub3JtYWxpemVWYWx1ZSh2YWx1ZSlcbiAgfVxuXG4gIEhlYWRlcnMucHJvdG90eXBlLmZvckVhY2ggPSBmdW5jdGlvbihjYWxsYmFjaywgdGhpc0FyZykge1xuICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcy5tYXApIHtcbiAgICAgIGlmICh0aGlzLm1hcC5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXNBcmcsIHRoaXMubWFwW25hbWVdLCBuYW1lLCB0aGlzKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIEhlYWRlcnMucHJvdG90eXBlLmtleXMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXRlbXMgPSBbXVxuICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwgbmFtZSkgeyBpdGVtcy5wdXNoKG5hbWUpIH0pXG4gICAgcmV0dXJuIGl0ZXJhdG9yRm9yKGl0ZW1zKVxuICB9XG5cbiAgSGVhZGVycy5wcm90b3R5cGUudmFsdWVzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGl0ZW1zID0gW11cbiAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHsgaXRlbXMucHVzaCh2YWx1ZSkgfSlcbiAgICByZXR1cm4gaXRlcmF0b3JGb3IoaXRlbXMpXG4gIH1cblxuICBIZWFkZXJzLnByb3RvdHlwZS5lbnRyaWVzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGl0ZW1zID0gW11cbiAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIG5hbWUpIHsgaXRlbXMucHVzaChbbmFtZSwgdmFsdWVdKSB9KVxuICAgIHJldHVybiBpdGVyYXRvckZvcihpdGVtcylcbiAgfVxuXG4gIGlmIChzdXBwb3J0Lml0ZXJhYmxlKSB7XG4gICAgSGVhZGVycy5wcm90b3R5cGVbU3ltYm9sLml0ZXJhdG9yXSA9IEhlYWRlcnMucHJvdG90eXBlLmVudHJpZXNcbiAgfVxuXG4gIGZ1bmN0aW9uIGNvbnN1bWVkKGJvZHkpIHtcbiAgICBpZiAoYm9keS5ib2R5VXNlZCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBUeXBlRXJyb3IoJ0FscmVhZHkgcmVhZCcpKVxuICAgIH1cbiAgICBib2R5LmJvZHlVc2VkID0gdHJ1ZVxuICB9XG5cbiAgZnVuY3Rpb24gZmlsZVJlYWRlclJlYWR5KHJlYWRlcikge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZWFkZXIucmVzdWx0KVxuICAgICAgfVxuICAgICAgcmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlYWRlci5lcnJvcilcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgZnVuY3Rpb24gcmVhZEJsb2JBc0FycmF5QnVmZmVyKGJsb2IpIHtcbiAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgIHZhciBwcm9taXNlID0gZmlsZVJlYWRlclJlYWR5KHJlYWRlcilcbiAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYilcbiAgICByZXR1cm4gcHJvbWlzZVxuICB9XG5cbiAgZnVuY3Rpb24gcmVhZEJsb2JBc1RleHQoYmxvYikge1xuICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG4gICAgdmFyIHByb21pc2UgPSBmaWxlUmVhZGVyUmVhZHkocmVhZGVyKVxuICAgIHJlYWRlci5yZWFkQXNUZXh0KGJsb2IpXG4gICAgcmV0dXJuIHByb21pc2VcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRBcnJheUJ1ZmZlckFzVGV4dChidWYpIHtcbiAgICB2YXIgdmlldyA9IG5ldyBVaW50OEFycmF5KGJ1ZilcbiAgICB2YXIgY2hhcnMgPSBuZXcgQXJyYXkodmlldy5sZW5ndGgpXG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNoYXJzW2ldID0gU3RyaW5nLmZyb21DaGFyQ29kZSh2aWV3W2ldKVxuICAgIH1cbiAgICByZXR1cm4gY2hhcnMuam9pbignJylcbiAgfVxuXG4gIGZ1bmN0aW9uIGJ1ZmZlckNsb25lKGJ1Zikge1xuICAgIGlmIChidWYuc2xpY2UpIHtcbiAgICAgIHJldHVybiBidWYuc2xpY2UoMClcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHZpZXcgPSBuZXcgVWludDhBcnJheShidWYuYnl0ZUxlbmd0aClcbiAgICAgIHZpZXcuc2V0KG5ldyBVaW50OEFycmF5KGJ1ZikpXG4gICAgICByZXR1cm4gdmlldy5idWZmZXJcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBCb2R5KCkge1xuICAgIHRoaXMuYm9keVVzZWQgPSBmYWxzZVxuXG4gICAgdGhpcy5faW5pdEJvZHkgPSBmdW5jdGlvbihib2R5KSB7XG4gICAgICB0aGlzLl9ib2R5SW5pdCA9IGJvZHlcbiAgICAgIGlmICghYm9keSkge1xuICAgICAgICB0aGlzLl9ib2R5VGV4dCA9ICcnXG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykge1xuICAgICAgICB0aGlzLl9ib2R5VGV4dCA9IGJvZHlcbiAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydC5ibG9iICYmIEJsb2IucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkpIHtcbiAgICAgICAgdGhpcy5fYm9keUJsb2IgPSBib2R5XG4gICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuZm9ybURhdGEgJiYgRm9ybURhdGEucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkpIHtcbiAgICAgICAgdGhpcy5fYm9keUZvcm1EYXRhID0gYm9keVxuICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LnNlYXJjaFBhcmFtcyAmJiBVUkxTZWFyY2hQYXJhbXMucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkpIHtcbiAgICAgICAgdGhpcy5fYm9keVRleHQgPSBib2R5LnRvU3RyaW5nKClcbiAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydC5hcnJheUJ1ZmZlciAmJiBzdXBwb3J0LmJsb2IgJiYgaXNEYXRhVmlldyhib2R5KSkge1xuICAgICAgICB0aGlzLl9ib2R5QXJyYXlCdWZmZXIgPSBidWZmZXJDbG9uZShib2R5LmJ1ZmZlcilcbiAgICAgICAgLy8gSUUgMTAtMTEgY2FuJ3QgaGFuZGxlIGEgRGF0YVZpZXcgYm9keS5cbiAgICAgICAgdGhpcy5fYm9keUluaXQgPSBuZXcgQmxvYihbdGhpcy5fYm9keUFycmF5QnVmZmVyXSlcbiAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydC5hcnJheUJ1ZmZlciAmJiAoQXJyYXlCdWZmZXIucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkgfHwgaXNBcnJheUJ1ZmZlclZpZXcoYm9keSkpKSB7XG4gICAgICAgIHRoaXMuX2JvZHlBcnJheUJ1ZmZlciA9IGJ1ZmZlckNsb25lKGJvZHkpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Vuc3VwcG9ydGVkIEJvZHlJbml0IHR5cGUnKVxuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYm9keSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KCdjb250ZW50LXR5cGUnLCAndGV4dC9wbGFpbjtjaGFyc2V0PVVURi04JylcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9ib2R5QmxvYiAmJiB0aGlzLl9ib2R5QmxvYi50eXBlKSB7XG4gICAgICAgICAgdGhpcy5oZWFkZXJzLnNldCgnY29udGVudC10eXBlJywgdGhpcy5fYm9keUJsb2IudHlwZSlcbiAgICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LnNlYXJjaFBhcmFtcyAmJiBVUkxTZWFyY2hQYXJhbXMucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkpIHtcbiAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KCdjb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkO2NoYXJzZXQ9VVRGLTgnKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHN1cHBvcnQuYmxvYikge1xuICAgICAgdGhpcy5ibG9iID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciByZWplY3RlZCA9IGNvbnN1bWVkKHRoaXMpXG4gICAgICAgIGlmIChyZWplY3RlZCkge1xuICAgICAgICAgIHJldHVybiByZWplY3RlZFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX2JvZHlCbG9iKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLl9ib2R5QmxvYilcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9ib2R5QXJyYXlCdWZmZXIpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBCbG9iKFt0aGlzLl9ib2R5QXJyYXlCdWZmZXJdKSlcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9ib2R5Rm9ybURhdGEpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvdWxkIG5vdCByZWFkIEZvcm1EYXRhIGJvZHkgYXMgYmxvYicpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgQmxvYihbdGhpcy5fYm9keVRleHRdKSlcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmFycmF5QnVmZmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLl9ib2R5QXJyYXlCdWZmZXIpIHtcbiAgICAgICAgICByZXR1cm4gY29uc3VtZWQodGhpcykgfHwgUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2JvZHlBcnJheUJ1ZmZlcilcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5ibG9iKCkudGhlbihyZWFkQmxvYkFzQXJyYXlCdWZmZXIpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnRleHQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByZWplY3RlZCA9IGNvbnN1bWVkKHRoaXMpXG4gICAgICBpZiAocmVqZWN0ZWQpIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdGVkXG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9ib2R5QmxvYikge1xuICAgICAgICByZXR1cm4gcmVhZEJsb2JBc1RleHQodGhpcy5fYm9keUJsb2IpXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlYWRBcnJheUJ1ZmZlckFzVGV4dCh0aGlzLl9ib2R5QXJyYXlCdWZmZXIpKVxuICAgICAgfSBlbHNlIGlmICh0aGlzLl9ib2R5Rm9ybURhdGEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb3VsZCBub3QgcmVhZCBGb3JtRGF0YSBib2R5IGFzIHRleHQnKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLl9ib2R5VGV4dClcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3VwcG9ydC5mb3JtRGF0YSkge1xuICAgICAgdGhpcy5mb3JtRGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0KCkudGhlbihkZWNvZGUpXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5qc29uID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy50ZXh0KCkudGhlbihKU09OLnBhcnNlKVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICAvLyBIVFRQIG1ldGhvZHMgd2hvc2UgY2FwaXRhbGl6YXRpb24gc2hvdWxkIGJlIG5vcm1hbGl6ZWRcbiAgdmFyIG1ldGhvZHMgPSBbJ0RFTEVURScsICdHRVQnLCAnSEVBRCcsICdPUFRJT05TJywgJ1BPU1QnLCAnUFVUJ11cblxuICBmdW5jdGlvbiBub3JtYWxpemVNZXRob2QobWV0aG9kKSB7XG4gICAgdmFyIHVwY2FzZWQgPSBtZXRob2QudG9VcHBlckNhc2UoKVxuICAgIHJldHVybiAobWV0aG9kcy5pbmRleE9mKHVwY2FzZWQpID4gLTEpID8gdXBjYXNlZCA6IG1ldGhvZFxuICB9XG5cbiAgZnVuY3Rpb24gUmVxdWVzdChpbnB1dCwgb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9XG4gICAgdmFyIGJvZHkgPSBvcHRpb25zLmJvZHlcblxuICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7XG4gICAgICB0aGlzLnVybCA9IGlucHV0XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChpbnB1dC5ib2R5VXNlZCkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBbHJlYWR5IHJlYWQnKVxuICAgICAgfVxuICAgICAgdGhpcy51cmwgPSBpbnB1dC51cmxcbiAgICAgIHRoaXMuY3JlZGVudGlhbHMgPSBpbnB1dC5jcmVkZW50aWFsc1xuICAgICAgaWYgKCFvcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgICAgdGhpcy5oZWFkZXJzID0gbmV3IEhlYWRlcnMoaW5wdXQuaGVhZGVycylcbiAgICAgIH1cbiAgICAgIHRoaXMubWV0aG9kID0gaW5wdXQubWV0aG9kXG4gICAgICB0aGlzLm1vZGUgPSBpbnB1dC5tb2RlXG4gICAgICBpZiAoIWJvZHkgJiYgaW5wdXQuX2JvZHlJbml0ICE9IG51bGwpIHtcbiAgICAgICAgYm9keSA9IGlucHV0Ll9ib2R5SW5pdFxuICAgICAgICBpbnB1dC5ib2R5VXNlZCA9IHRydWVcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmNyZWRlbnRpYWxzID0gb3B0aW9ucy5jcmVkZW50aWFscyB8fCB0aGlzLmNyZWRlbnRpYWxzIHx8ICdvbWl0J1xuICAgIGlmIChvcHRpb25zLmhlYWRlcnMgfHwgIXRoaXMuaGVhZGVycykge1xuICAgICAgdGhpcy5oZWFkZXJzID0gbmV3IEhlYWRlcnMob3B0aW9ucy5oZWFkZXJzKVxuICAgIH1cbiAgICB0aGlzLm1ldGhvZCA9IG5vcm1hbGl6ZU1ldGhvZChvcHRpb25zLm1ldGhvZCB8fCB0aGlzLm1ldGhvZCB8fCAnR0VUJylcbiAgICB0aGlzLm1vZGUgPSBvcHRpb25zLm1vZGUgfHwgdGhpcy5tb2RlIHx8IG51bGxcbiAgICB0aGlzLnJlZmVycmVyID0gbnVsbFxuXG4gICAgaWYgKCh0aGlzLm1ldGhvZCA9PT0gJ0dFVCcgfHwgdGhpcy5tZXRob2QgPT09ICdIRUFEJykgJiYgYm9keSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQm9keSBub3QgYWxsb3dlZCBmb3IgR0VUIG9yIEhFQUQgcmVxdWVzdHMnKVxuICAgIH1cbiAgICB0aGlzLl9pbml0Qm9keShib2R5KVxuICB9XG5cbiAgUmVxdWVzdC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFJlcXVlc3QodGhpcywgeyBib2R5OiB0aGlzLl9ib2R5SW5pdCB9KVxuICB9XG5cbiAgZnVuY3Rpb24gZGVjb2RlKGJvZHkpIHtcbiAgICB2YXIgZm9ybSA9IG5ldyBGb3JtRGF0YSgpXG4gICAgYm9keS50cmltKCkuc3BsaXQoJyYnKS5mb3JFYWNoKGZ1bmN0aW9uKGJ5dGVzKSB7XG4gICAgICBpZiAoYnl0ZXMpIHtcbiAgICAgICAgdmFyIHNwbGl0ID0gYnl0ZXMuc3BsaXQoJz0nKVxuICAgICAgICB2YXIgbmFtZSA9IHNwbGl0LnNoaWZ0KCkucmVwbGFjZSgvXFwrL2csICcgJylcbiAgICAgICAgdmFyIHZhbHVlID0gc3BsaXQuam9pbignPScpLnJlcGxhY2UoL1xcKy9nLCAnICcpXG4gICAgICAgIGZvcm0uYXBwZW5kKGRlY29kZVVSSUNvbXBvbmVudChuYW1lKSwgZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKSlcbiAgICAgIH1cbiAgICB9KVxuICAgIHJldHVybiBmb3JtXG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUhlYWRlcnMocmF3SGVhZGVycykge1xuICAgIHZhciBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKVxuICAgIHJhd0hlYWRlcnMuc3BsaXQoJ1xcclxcbicpLmZvckVhY2goZnVuY3Rpb24obGluZSkge1xuICAgICAgdmFyIHBhcnRzID0gbGluZS5zcGxpdCgnOicpXG4gICAgICB2YXIga2V5ID0gcGFydHMuc2hpZnQoKS50cmltKClcbiAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gcGFydHMuam9pbignOicpLnRyaW0oKVxuICAgICAgICBoZWFkZXJzLmFwcGVuZChrZXksIHZhbHVlKVxuICAgICAgfVxuICAgIH0pXG4gICAgcmV0dXJuIGhlYWRlcnNcbiAgfVxuXG4gIEJvZHkuY2FsbChSZXF1ZXN0LnByb3RvdHlwZSlcblxuICBmdW5jdGlvbiBSZXNwb25zZShib2R5SW5pdCwgb3B0aW9ucykge1xuICAgIGlmICghb3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IHt9XG4gICAgfVxuXG4gICAgdGhpcy50eXBlID0gJ2RlZmF1bHQnXG4gICAgdGhpcy5zdGF0dXMgPSAnc3RhdHVzJyBpbiBvcHRpb25zID8gb3B0aW9ucy5zdGF0dXMgOiAyMDBcbiAgICB0aGlzLm9rID0gdGhpcy5zdGF0dXMgPj0gMjAwICYmIHRoaXMuc3RhdHVzIDwgMzAwXG4gICAgdGhpcy5zdGF0dXNUZXh0ID0gJ3N0YXR1c1RleHQnIGluIG9wdGlvbnMgPyBvcHRpb25zLnN0YXR1c1RleHQgOiAnT0snXG4gICAgdGhpcy5oZWFkZXJzID0gbmV3IEhlYWRlcnMob3B0aW9ucy5oZWFkZXJzKVxuICAgIHRoaXMudXJsID0gb3B0aW9ucy51cmwgfHwgJydcbiAgICB0aGlzLl9pbml0Qm9keShib2R5SW5pdClcbiAgfVxuXG4gIEJvZHkuY2FsbChSZXNwb25zZS5wcm90b3R5cGUpXG5cbiAgUmVzcG9uc2UucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZSh0aGlzLl9ib2R5SW5pdCwge1xuICAgICAgc3RhdHVzOiB0aGlzLnN0YXR1cyxcbiAgICAgIHN0YXR1c1RleHQ6IHRoaXMuc3RhdHVzVGV4dCxcbiAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHRoaXMuaGVhZGVycyksXG4gICAgICB1cmw6IHRoaXMudXJsXG4gICAgfSlcbiAgfVxuXG4gIFJlc3BvbnNlLmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJlc3BvbnNlID0gbmV3IFJlc3BvbnNlKG51bGwsIHtzdGF0dXM6IDAsIHN0YXR1c1RleHQ6ICcnfSlcbiAgICByZXNwb25zZS50eXBlID0gJ2Vycm9yJ1xuICAgIHJldHVybiByZXNwb25zZVxuICB9XG5cbiAgdmFyIHJlZGlyZWN0U3RhdHVzZXMgPSBbMzAxLCAzMDIsIDMwMywgMzA3LCAzMDhdXG5cbiAgUmVzcG9uc2UucmVkaXJlY3QgPSBmdW5jdGlvbih1cmwsIHN0YXR1cykge1xuICAgIGlmIChyZWRpcmVjdFN0YXR1c2VzLmluZGV4T2Yoc3RhdHVzKSA9PT0gLTEpIHtcbiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIHN0YXR1cyBjb2RlJylcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKG51bGwsIHtzdGF0dXM6IHN0YXR1cywgaGVhZGVyczoge2xvY2F0aW9uOiB1cmx9fSlcbiAgfVxuXG4gIHNlbGYuSGVhZGVycyA9IEhlYWRlcnNcbiAgc2VsZi5SZXF1ZXN0ID0gUmVxdWVzdFxuICBzZWxmLlJlc3BvbnNlID0gUmVzcG9uc2VcblxuICBzZWxmLmZldGNoID0gZnVuY3Rpb24oaW5wdXQsIGluaXQpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KGlucHV0LCBpbml0KVxuICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpXG5cbiAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgc3RhdHVzOiB4aHIuc3RhdHVzLFxuICAgICAgICAgIHN0YXR1c1RleHQ6IHhoci5zdGF0dXNUZXh0LFxuICAgICAgICAgIGhlYWRlcnM6IHBhcnNlSGVhZGVycyh4aHIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCkgfHwgJycpXG4gICAgICAgIH1cbiAgICAgICAgb3B0aW9ucy51cmwgPSAncmVzcG9uc2VVUkwnIGluIHhociA/IHhoci5yZXNwb25zZVVSTCA6IG9wdGlvbnMuaGVhZGVycy5nZXQoJ1gtUmVxdWVzdC1VUkwnKVxuICAgICAgICB2YXIgYm9keSA9ICdyZXNwb25zZScgaW4geGhyID8geGhyLnJlc3BvbnNlIDogeGhyLnJlc3BvbnNlVGV4dFxuICAgICAgICByZXNvbHZlKG5ldyBSZXNwb25zZShib2R5LCBvcHRpb25zKSlcbiAgICAgIH1cblxuICAgICAgeGhyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KG5ldyBUeXBlRXJyb3IoJ05ldHdvcmsgcmVxdWVzdCBmYWlsZWQnKSlcbiAgICAgIH1cblxuICAgICAgeGhyLm9udGltZW91dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QobmV3IFR5cGVFcnJvcignTmV0d29yayByZXF1ZXN0IGZhaWxlZCcpKVxuICAgICAgfVxuXG4gICAgICB4aHIub3BlbihyZXF1ZXN0Lm1ldGhvZCwgcmVxdWVzdC51cmwsIHRydWUpXG5cbiAgICAgIGlmIChyZXF1ZXN0LmNyZWRlbnRpYWxzID09PSAnaW5jbHVkZScpIHtcbiAgICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IHRydWVcbiAgICAgIH1cblxuICAgICAgaWYgKCdyZXNwb25zZVR5cGUnIGluIHhociAmJiBzdXBwb3J0LmJsb2IpIHtcbiAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdibG9iJ1xuICAgICAgfVxuXG4gICAgICByZXF1ZXN0LmhlYWRlcnMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwgbmFtZSkge1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihuYW1lLCB2YWx1ZSlcbiAgICAgIH0pXG5cbiAgICAgIHhoci5zZW5kKHR5cGVvZiByZXF1ZXN0Ll9ib2R5SW5pdCA9PT0gJ3VuZGVmaW5lZCcgPyBudWxsIDogcmVxdWVzdC5fYm9keUluaXQpXG4gICAgfSlcbiAgfVxuICBzZWxmLmZldGNoLnBvbHlmaWxsID0gdHJ1ZVxufSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMpO1xuIl19\n"]}